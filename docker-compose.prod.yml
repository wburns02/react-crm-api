version: '3.8'

# Production Docker Compose Configuration
#
# Usage: docker-compose -f docker-compose.prod.yml up -d
#
# Key differences from development:
# - No volume mounts (uses built image)
# - No --reload flag
# - Production environment settings
# - API docs disabled by default

services:
  api:
    build: .
    ports:
      - "5001:5001"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - FRONTEND_URL=${FRONTEND_URL:-https://react.ecbtx.com}
      - ENVIRONMENT=production
      - DEBUG=false
      - DOCS_ENABLED=false
    command: uvicorn app.main:app --host 0.0.0.0 --port 5001 --workers 4
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
